<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Implements Markov chain Monte Carlo via repeated TransitionKernel steps. — mcmc_sample_chain • tfprobability</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Implements Markov chain Monte Carlo via repeated TransitionKernel steps. — mcmc_sample_chain" />
<meta property="og:description" content="This function samples from an Markov chain at current_state and whose
stationary distribution is governed by the supplied TransitionKernel
instance (kernel)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tfprobability</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.11.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/dynamic_linear_models.html">Dynamic linear models</a>
    </li>
    <li>
      <a href="../articles/hamiltonian_monte_carlo.html">Multi-level modeling with Hamiltonian Monte Carlo</a>
    </li>
    <li>
      <a href="../articles/layer_dense_variational.html">Uncertainty estimates with layer_dense_variational</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rstudio/tfprobability/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Implements Markov chain Monte Carlo via repeated <code>TransitionKernel</code> steps.</h1>
    <small class="dont-index">Source: <a href='https://github.com/rstudio/tfprobability/blob/master/R/mcmc-functions.R'><code>R/mcmc-functions.R</code></a></small>
    <div class="hidden name"><code>mcmc_sample_chain.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function samples from an Markov chain at <code>current_state</code> and whose
stationary distribution is governed by the supplied <code>TransitionKernel</code>
instance (<code>kernel</code>).</p>
    </div>

    <pre class="usage"><span class='fu'>mcmc_sample_chain</span><span class='op'>(</span>
  kernel <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>num_results</span>,
  <span class='va'>current_state</span>,
  previous_kernel_results <span class='op'>=</span> <span class='cn'>NULL</span>,
  num_burnin_steps <span class='op'>=</span> <span class='fl'>0</span>,
  num_steps_between_results <span class='op'>=</span> <span class='fl'>0</span>,
  trace_fn <span class='op'>=</span> <span class='cn'>NULL</span>,
  return_final_kernel_results <span class='op'>=</span> <span class='cn'>FALSE</span>,
  parallel_iterations <span class='op'>=</span> <span class='fl'>10</span>,
  seed <span class='op'>=</span> <span class='cn'>NULL</span>,
  name <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>kernel</th>
      <td><p>An instance of <code>tfp$mcmc$TransitionKernel</code> which implements one step
of the Markov chain.</p></td>
    </tr>
    <tr>
      <th>num_results</th>
      <td><p>Integer number of Markov chain draws.</p></td>
    </tr>
    <tr>
      <th>current_state</th>
      <td><p><code>Tensor</code> or <code>list</code> of <code>Tensor</code>s representing the
current state(s) of the Markov chain(s).</p></td>
    </tr>
    <tr>
      <th>previous_kernel_results</th>
      <td><p>A <code>Tensor</code> or a nested collection of <code>Tensor</code>s
representing internal calculations made within the previous call to this
function (or as returned by <code>bootstrap_results</code>).</p></td>
    </tr>
    <tr>
      <th>num_burnin_steps</th>
      <td><p>Integer number of chain steps to take before starting to
collect results. Default value: 0 (i.e., no burn-in).</p></td>
    </tr>
    <tr>
      <th>num_steps_between_results</th>
      <td><p>Integer number of chain steps between collecting
a result. Only one out of every <code>num_steps_between_samples + 1</code> steps is
included in the returned results.  The number of returned chain states is
still equal to <code>num_results</code>.  Default value: 0 (i.e., no thinning).</p></td>
    </tr>
    <tr>
      <th>trace_fn</th>
      <td><p>A function that takes in the current chain state and the previous
kernel results and return a <code>Tensor</code> or a nested collection of <code>Tensor</code>s
that is then traced along with the chain state.</p></td>
    </tr>
    <tr>
      <th>return_final_kernel_results</th>
      <td><p>If <code>TRUE</code>, then the final kernel results are
returned alongside the chain state and the trace specified by the <code>trace_fn</code>.</p></td>
    </tr>
    <tr>
      <th>parallel_iterations</th>
      <td><p>The number of iterations allowed to run in parallel. It
must be a positive integer. See <code>tf$while_loop</code> for more details.</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>Optional, a seed for reproducible sampling.</p></td>
    </tr>
    <tr>
      <th>name</th>
      <td><p>string prefixed to Ops created by this function. Default value: <code>NULL</code>,
(i.e., "mcmc_sample_chain").</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>list of:</p><ul>
<li><p>checkpointable_states_and_trace: if <code>return_final_kernel_results</code> is
<code>TRUE</code>. The return value is an instance of <code>CheckpointableStatesAndTrace</code>.</p></li>
<li><p>all_states: if <code>return_final_kernel_results</code> is <code>FALSE</code> and <code>trace_fn</code> is
<code>NULL</code>. The return value is a <code>Tensor</code> or Python list of <code>Tensor</code>s
representing the state(s) of the Markov chain(s) at each result step. Has
same shape as input <code>current_state</code> but with a prepended
<code>num_results</code>-size dimension.</p></li>
<li><p>states_and_trace: if <code>return_final_kernel_results</code> is <code>FALSE</code> and
<code>trace_fn</code> is not <code>NULL</code>. The return value is an instance of
<code>StatesAndTrace</code>.</p></li>
</ul>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function can sample from multiple chains, in parallel. (Whether or not
there are multiple chains is dictated by the <code>kernel</code>.)</p>
<p>The <code>current_state</code> can be represented as a single <code>Tensor</code> or a <code>list</code> of
<code>Tensors</code> which collectively represent the current state.
Since MCMC states are correlated, it is sometimes desirable to produce
additional intermediate states, and then discard them, ending up with a set of
states with decreased autocorrelation.  See Owen (2017). Such "thinning"
is made possible by setting <code>num_steps_between_results &gt; 0</code>. The chain then
takes <code>num_steps_between_results</code> extra steps between the steps that make it
into the results. The extra steps are never materialized (in calls to
<code>sess$run</code>), and thus do not increase memory requirements.</p>
<p>Warning: when setting a <code>seed</code> in the <code>kernel</code>, ensure that <code>sample_chain</code>'s
<code>parallel_iterations=1</code>, otherwise results will not be reproducible.
In addition to returning the chain state, this function supports tracing of
auxiliary variables used by the kernel. The traced values are selected by
specifying <code>trace_fn</code>. By default, all kernel results are traced but in the
future the default will be changed to no results being traced, so plan
accordingly. See below for some examples of this feature.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    

<ul>
<li><p><a href='http://statweb.stanford.edu/~owen/reports/bestthinning.pdf'>Art B. Owen. Statistically efficient thinning of a Markov chain sampler. <em>Technical Report</em>, 2017.</a></p></li>
</ul>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other mcmc_functions: 
<code><a href='mcmc_effective_sample_size.html'>mcmc_effective_sample_size</a>()</code>,
<code><a href='mcmc_potential_scale_reduction.html'>mcmc_potential_scale_reduction</a>()</code>,
<code><a href='mcmc_sample_annealed_importance_chain.html'>mcmc_sample_annealed_importance_chain</a>()</code>,
<code><a href='mcmc_sample_halton_sequence.html'>mcmc_sample_halton_sequence</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \donttest{</span>
  <span class='va'>dims</span> <span class='op'>&lt;-</span> <span class='fl'>10</span>
  <span class='va'>true_stddev</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>3</span>, length.out <span class='op'>=</span> <span class='va'>dims</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>likelihood</span> <span class='op'>&lt;-</span> <span class='fu'><a href='tfd_multivariate_normal_diag.html'>tfd_multivariate_normal_diag</a></span><span class='op'>(</span>scale_diag <span class='op'>=</span> <span class='va'>true_stddev</span><span class='op'>)</span>

  <span class='va'>kernel</span> <span class='op'>&lt;-</span> <span class='fu'><a href='mcmc_hamiltonian_monte_carlo.html'>mcmc_hamiltonian_monte_carlo</a></span><span class='op'>(</span>
    target_log_prob_fn <span class='op'>=</span> <span class='va'>likelihood</span><span class='op'>$</span><span class='va'>log_prob</span>,
    step_size <span class='op'>=</span> <span class='fl'>0.5</span>,
    num_leapfrog_steps <span class='op'>=</span> <span class='fl'>2</span>
  <span class='op'>)</span>

  <span class='va'>states</span> <span class='op'>&lt;-</span> <span class='va'>kernel</span> <span class='op'>%&gt;%</span> <span class='fu'>mcmc_sample_chain</span><span class='op'>(</span>
    num_results <span class='op'>=</span> <span class='fl'>1000</span>,
    num_burnin_steps <span class='op'>=</span> <span class='fl'>500</span>,
    current_state <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='va'>dims</span><span class='op'>)</span>,
    trace_fn <span class='op'>=</span> <span class='cn'>NULL</span>
  <span class='op'>)</span>

  <span class='va'>sample_mean</span> <span class='op'>&lt;-</span> <span class='va'>tf</span><span class='op'>$</span><span class='fu'>reduce_mean</span><span class='op'>(</span><span class='va'>states</span>, axis <span class='op'>=</span> <span class='fl'>0L</span><span class='op'>)</span>
  <span class='va'>sample_stddev</span> <span class='op'>&lt;-</span> <span class='va'>tf</span><span class='op'>$</span><span class='fu'>sqrt</span><span class='op'>(</span>
    <span class='va'>tf</span><span class='op'>$</span><span class='fu'>reduce_mean</span><span class='op'>(</span><span class='va'>tf</span><span class='op'>$</span><span class='va'>math</span><span class='op'>$</span><span class='fu'>squared_difference</span><span class='op'>(</span><span class='va'>states</span>, <span class='va'>sample_mean</span><span class='op'>)</span>, axis <span class='op'>=</span> <span class='fl'>0L</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># }</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Sigrid Keydana.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


