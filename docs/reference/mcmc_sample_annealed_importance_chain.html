<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Runs annealed importance sampling (AIS) to estimate normalizing constants. — mcmc_sample_annealed_importance_chain • tfprobability</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Runs annealed importance sampling (AIS) to estimate normalizing constants. — mcmc_sample_annealed_importance_chain" />
<meta property="og:description" content="This function uses an MCMC transition operator (e.g., Hamiltonian Monte Carlo)
to sample from a series of distributions that slowly interpolates between
an initial &quot;proposal&quot; distribution:
exp(proposal_log_prob_fn(x) - proposal_log_normalizer)
and the target distribution:
exp(target_log_prob_fn(x) - target_log_normalizer),
accumulating importance weights along the way. The product of these
importance weights gives an unbiased estimate of the ratio of the
normalizing constants of the initial distribution and the target
distribution:
E[exp(ais_weights)] = exp(target_log_normalizer - proposal_log_normalizer)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tfprobability</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.11.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/dynamic_linear_models.html">Dynamic linear models</a>
    </li>
    <li>
      <a href="../articles/hamiltonian_monte_carlo.html">Multi-level modeling with Hamiltonian Monte Carlo</a>
    </li>
    <li>
      <a href="../articles/layer_dense_variational.html">Uncertainty estimates with layer_dense_variational</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rstudio/tfprobability/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Runs annealed importance sampling (AIS) to estimate normalizing constants.</h1>
    <small class="dont-index">Source: <a href='https://github.com/rstudio/tfprobability/blob/master/R/mcmc-functions.R'><code>R/mcmc-functions.R</code></a></small>
    <div class="hidden name"><code>mcmc_sample_annealed_importance_chain.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function uses an MCMC transition operator (e.g., Hamiltonian Monte Carlo)
to sample from a series of distributions that slowly interpolates between
an initial "proposal" distribution:
<code><a href='https://rdrr.io/r/base/Log.html'>exp(proposal_log_prob_fn(x) - proposal_log_normalizer)</a></code>
and the target distribution:
<code><a href='https://rdrr.io/r/base/Log.html'>exp(target_log_prob_fn(x) - target_log_normalizer)</a></code>,
accumulating importance weights along the way. The product of these
importance weights gives an unbiased estimate of the ratio of the
normalizing constants of the initial distribution and the target
distribution:
<code>E[exp(ais_weights)] = exp(target_log_normalizer - proposal_log_normalizer)</code>.</p>
    </div>

    <pre class="usage"><span class='fu'>mcmc_sample_annealed_importance_chain</span><span class='op'>(</span>
  <span class='va'>num_steps</span>,
  <span class='va'>proposal_log_prob_fn</span>,
  <span class='va'>target_log_prob_fn</span>,
  <span class='va'>current_state</span>,
  <span class='va'>make_kernel_fn</span>,
  parallel_iterations <span class='op'>=</span> <span class='fl'>10</span>,
  name <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>num_steps</th>
      <td><p>Integer number of Markov chain updates to run. More
iterations means more expense, but smoother annealing between q
and p, which in turn means exponentially lower variance for the
normalizing constant estimator.</p></td>
    </tr>
    <tr>
      <th>proposal_log_prob_fn</th>
      <td><p>function that returns the log density of the
initial distribution.</p></td>
    </tr>
    <tr>
      <th>target_log_prob_fn</th>
      <td><p>function which takes an argument like
<code>current_state</code> and returns its
(possibly unnormalized) log-density under the target distribution.</p></td>
    </tr>
    <tr>
      <th>current_state</th>
      <td><p><code>Tensor</code> or <code>list</code> of <code>Tensor</code>s representing the
current state(s) of the Markov chain(s). The first <code>r</code> dimensions index
independent chains, <code>r</code> = <code>tf$rank(target_log_prob_fn(current_state))</code>.</p></td>
    </tr>
    <tr>
      <th>make_kernel_fn</th>
      <td><p>function which returns a <code>TransitionKernel</code>-like
object. Must take one argument representing the <code>TransitionKernel</code>'s
<code>target_log_prob_fn</code>. The <code>target_log_prob_fn</code> argument represents the
<code>TransitionKernel</code>'s target log distribution.  Note:
<code>sample_annealed_importance_chain</code> creates a new <code>target_log_prob_fn</code>
which is an interpolation between the supplied <code>target_log_prob_fn</code> and
<code>proposal_log_prob_fn</code>; it is this interpolated function which is used as
an argument to <code>make_kernel_fn</code>.</p></td>
    </tr>
    <tr>
      <th>parallel_iterations</th>
      <td><p>The number of iterations allowed to run in parallel.
It must be a positive integer. See <code>tf$while_loop</code> for more details.</p></td>
    </tr>
    <tr>
      <th>name</th>
      <td><p>string prefixed to Ops created by this function.
Default value: <code>NULL</code> (i.e., "sample_annealed_importance_chain").</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>list of
<code>next_state</code> (<code>Tensor</code> or Python list of <code>Tensor</code>s representing the
state(s) of the Markov chain(s) at the final iteration. Has same shape as
input <code>current_state</code>),
<code>ais_weights</code> (Tensor with the estimated weight(s). Has shape matching
<code>target_log_prob_fn(current_state)</code>), and
<code>kernel_results</code> (<code>collections.namedtuple</code> of internal calculations used to
advance the chain).</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Note: When running in graph mode, <code>proposal_log_prob_fn</code> and
<code>target_log_prob_fn</code> are called exactly three times (although this may be
reduced to two times in the future).</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>For an example how to use see <code><a href='mcmc_sample_chain.html'>mcmc_sample_chain()</a></code>.</p>
<p>Other mcmc_functions: 
<code><a href='mcmc_effective_sample_size.html'>mcmc_effective_sample_size</a>()</code>,
<code><a href='mcmc_potential_scale_reduction.html'>mcmc_potential_scale_reduction</a>()</code>,
<code><a href='mcmc_sample_chain.html'>mcmc_sample_chain</a>()</code>,
<code><a href='mcmc_sample_halton_sequence.html'>mcmc_sample_halton_sequence</a>()</code></p></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Sigrid Keydana.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


