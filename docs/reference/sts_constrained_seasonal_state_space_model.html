<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Seasonal state space model with effects constrained to sum to zero. — sts_constrained_seasonal_state_space_model • tfprobability</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Seasonal state space model with effects constrained to sum to zero. — sts_constrained_seasonal_state_space_model" />
<meta property="og:description" content="Seasonal state space model with effects constrained to sum to zero." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tfprobability</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.11.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/dynamic_linear_models.html">Dynamic linear models</a>
    </li>
    <li>
      <a href="../articles/hamiltonian_monte_carlo.html">Multi-level modeling with Hamiltonian Monte Carlo</a>
    </li>
    <li>
      <a href="../articles/layer_dense_variational.html">Uncertainty estimates with layer_dense_variational</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rstudio/tfprobability/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Seasonal state space model with effects constrained to sum to zero.</h1>
    <small class="dont-index">Source: <a href='https://github.com/rstudio/tfprobability/blob/master/R/sts.R'><code>R/sts.R</code></a></small>
    <div class="hidden name"><code>sts_constrained_seasonal_state_space_model.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Seasonal state space model with effects constrained to sum to zero.</p>
    </div>

    <pre class="usage"><span class='fu'>sts_constrained_seasonal_state_space_model</span><span class='op'>(</span>
  <span class='va'>num_timesteps</span>,
  <span class='va'>num_seasons</span>,
  <span class='va'>drift_scale</span>,
  <span class='va'>initial_state_prior</span>,
  observation_noise_scale <span class='op'>=</span> <span class='fl'>1e-04</span>,
  num_steps_per_season <span class='op'>=</span> <span class='fl'>1</span>,
  initial_step <span class='op'>=</span> <span class='fl'>0</span>,
  validate_args <span class='op'>=</span> <span class='cn'>FALSE</span>,
  allow_nan_stats <span class='op'>=</span> <span class='cn'>TRUE</span>,
  name <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>num_timesteps</th>
      <td><p>Scalar <code>integer</code> <code>tensor</code> number of timesteps to model
with this distribution.</p></td>
    </tr>
    <tr>
      <th>num_seasons</th>
      <td><p>Scalar <code>integer</code> number of seasons.</p></td>
    </tr>
    <tr>
      <th>drift_scale</th>
      <td><p>Scalar (any additional dimensions are treated as batch
dimensions) <code>float</code> <code>tensor</code> indicating the standard deviation of the
change in effect between consecutive occurrences of a given season.
This is assumed to be the same for all seasons.</p></td>
    </tr>
    <tr>
      <th>initial_state_prior</th>
      <td><p>instance of <code>tfd_multivariate_normal</code>
representing the prior distribution on latent states; must
have event shape <code>[num_seasons]</code>.</p></td>
    </tr>
    <tr>
      <th>observation_noise_scale</th>
      <td><p>Scalar (any additional dimensions are
treated as batch dimensions) <code>float</code> <code>tensor</code> indicating the standard
deviation of the observation noise.</p></td>
    </tr>
    <tr>
      <th>num_steps_per_season</th>
      <td><p><code>integer</code> number of steps in each
season. This may be either a scalar (shape <code>[]</code>), in which case all
seasons have the same length, or an array of shape <code>[num_seasons]</code>,
in which seasons have different length, but remain constant around
different cycles, or an array of shape <code>[num_cycles, num_seasons]</code>,
in which num_steps_per_season for each season also varies in different
cycle (e.g., a 4 years cycle with leap day). Default value: 1.</p></td>
    </tr>
    <tr>
      <th>initial_step</th>
      <td><p>Optional scalar <code>integer</code> <code>tensor</code> specifying the starting
timestep. Default value: 0.</p></td>
    </tr>
    <tr>
      <th>validate_args</th>
      <td><p><code>logical</code>. Whether to validate input
with asserts. If <code>validate_args</code> is <code>FALSE</code>, and the inputs are
invalid, correct behavior is not guaranteed. Default value: <code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>allow_nan_stats</th>
      <td><p><code>logical</code>. If <code>FALSE</code>, raise an
exception if a statistic (e.g. mean/mode/etc...) is undefined for any
batch member. If <code>TRUE</code>, batch members with valid parameters leading to
undefined statistics will return NaN for this statistic. Default value: <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>name</th>
      <td><p>string prefixed to ops created by this class.
Default value: "SeasonalStateSpaceModel".</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>an instance of <code>LinearGaussianStateSpaceModel</code>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='sts_seasonal_state_space_model.html'>sts_seasonal_state_space_model()</a></code>.</p>
<p>Mathematical details</p>
<p>The constrained model implements a reparameterization of the
naive <code>SeasonalStateSpaceModel</code>. Instead of directly representing the
seasonal effects in the latent space, the latent space of the constrained
model represents the difference between each effect and the mean effect.
The following discussion assumes familiarity with the mathematical details
of <code>SeasonalStateSpaceModel</code>.</p>
<p><em>Reparameterization and constraints</em>: let the seasonal effects at a given
timestep be <code>E = [e_1, ..., e_N]</code>. The difference between each effect <code>e_i</code>
and the mean effect is <code>z_i = e_i - sum_i(e_i)/N</code>. By itself, this
transformation is not invertible because recovering the absolute effects
requires that we know the mean as well. To fix this, we'll define
<code>z_N = sum_i(e_i)/N</code> as the mean effect. It's easy to see that this is
invertible: given the mean effect and the differences of the first <code>N - 1</code>
effects from the mean, it's easy to solve for all <code>N</code> effects. Formally,
we've defined the invertible linear reparameterization <code>Z = R E</code>, where</p><pre>R = [1 - 1/N, -1/N,    ..., -1/N
     -1/N,    1 - 1/N, ..., -1/N,
     ...
     1/N,     1/N,     ...,  1/N]
</pre>

<p>represents the change of basis from 'effect coordinates' E to
'residual coordinates' Z. The <code>Z</code>s form the latent space of the
<code>ConstrainedSeasonalStateSpaceModel</code>.
To constrain the mean effect <code>z_N</code> to zero, we fix the prior to zero,
<code>p(z_N) ~ N(0., 0)</code>, and after the transition at each timestep we project
<code>z_N</code> back to zero. Note that this projection is linear: to set the Nth
dimension to zero, we simply multiply by the identity matrix with a missing
element in the bottom right, i.e., <code>Z_constrained = P Z</code>,
where <code>P = eye(N) - scatter((N-1, N-1), 1)</code>.</p>
<p><em>Model</em>: concretely, suppose a naive seasonal effect model has initial state
prior <code>N(m, S)</code>, transition matrix <code>F</code> and noise covariance
<code>Q</code>, and observation matrix <code>H</code>. Then the corresponding constrained seasonal
effect model has initial state prior <code>N(P R m, P R S R' P')</code>,
transition matrix <code>P R F R^-1</code> and noise covariance <code>F R Q R' F'</code>, and
observation matrix <code>H R^-1</code>, where the change-of-basis matrix <code>R</code> and
constraint projection matrix <code>P</code> are as defined above. This follows
directly from applying the reparameterization <code>Z = R E</code>, and then enforcing
the zero-sum constraint on the prior and transition noise covariances.
In practice, because the sum of effects <code>z_N</code> is constrained to be zero, it
will never contribute a term to any linear operation on the latent space,
so we can drop that dimension from the model entirely.
<code>ConstrainedSeasonalStateSpaceModel</code> does this, so that it implements the
<code>N - 1</code> dimension latent space <code>z_1, ..., z_[N-1]</code>.
Note that since we constrained the mean effect to be zero, the latent
<code>z_i</code>'s now recover their interpretation as the <em>actual</em> effects,
<code>z_i = e_i</code> for <code>i = </code>1, ..., N - 1<code>, even though they were originally defined as residuals. The </code>N<code>th effect is represented only implicitly, as the nonzero mean of the first </code>N - 1<code>effects. Although the computational represention is not symmetric across all</code>N<code>effects, we derived the</code>ConstrainedSeasonalStateSpaceModel<code>by starting with a symmetric representation and imposing only a symmetric constraint (the zero-sum constraint), so the probability model remains symmetric over all</code>N`
seasonal effects.</p>
<p>Other sts: 
<code><a href='sts_additive_state_space_model.html'>sts_additive_state_space_model</a>()</code>,
<code><a href='sts_autoregressive_state_space_model.html'>sts_autoregressive_state_space_model</a>()</code>,
<code><a href='sts_autoregressive.html'>sts_autoregressive</a>()</code>,
<code><a href='sts_dynamic_linear_regression_state_space_model.html'>sts_dynamic_linear_regression_state_space_model</a>()</code>,
<code><a href='sts_dynamic_linear_regression.html'>sts_dynamic_linear_regression</a>()</code>,
<code><a href='sts_linear_regression.html'>sts_linear_regression</a>()</code>,
<code><a href='sts_local_level_state_space_model.html'>sts_local_level_state_space_model</a>()</code>,
<code><a href='sts_local_level.html'>sts_local_level</a>()</code>,
<code><a href='sts_local_linear_trend_state_space_model.html'>sts_local_linear_trend_state_space_model</a>()</code>,
<code><a href='sts_local_linear_trend.html'>sts_local_linear_trend</a>()</code>,
<code><a href='sts_seasonal_state_space_model.html'>sts_seasonal_state_space_model</a>()</code>,
<code><a href='sts_seasonal.html'>sts_seasonal</a>()</code>,
<code><a href='sts_semi_local_linear_trend_state_space_model.html'>sts_semi_local_linear_trend_state_space_model</a>()</code>,
<code><a href='sts_semi_local_linear_trend.html'>sts_semi_local_linear_trend</a>()</code>,
<code><a href='sts_smooth_seasonal_state_space_model.html'>sts_smooth_seasonal_state_space_model</a>()</code>,
<code><a href='sts_smooth_seasonal.html'>sts_smooth_seasonal</a>()</code>,
<code><a href='sts_sparse_linear_regression.html'>sts_sparse_linear_regression</a>()</code>,
<code><a href='sts_sum.html'>sts_sum</a>()</code></p></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Sigrid Keydana.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


